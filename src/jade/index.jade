include mixins

doctype html
html(ng-app='mainApp')
	head
		meta(charset='UTF-8')
		meta(name='description', content='STV Calculator App')
		meta(name='author', content='Moritz Company')
		meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no')
		meta(name='apple-mobile-web-app-capable' content='yes')
		meta(name='apple-touch-fullscreen' content='yes')
		title Single Transferable Vote Calculator App
		link(rel='shortcut icon', href='favicon.ico')
		link(rel='stylesheet', href='https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css')
		link(rel='stylesheet', href='inc/main.css')
		script(src='inc/angular.js')
	body(ng-cloak ng-controller='MainCtrl')
		.container
			div(ng-hide="thanks || congrats")
				ul#sortable(ui-sortable ng-model='items' ng-hide="true")
					li(ng-repeat='item in items') {{item}}
				div(ng-hide="voteBallot || createBallot || resultsBallot")
					button.btn.btn-primary(ng-click="voteBallot = true") Vote
					button.btn.btn-success(ng-click="createBallot = true; generateRandomKey()") Create New Ballot
					button.btn.btn-default(onclick='runTheCode()' ng-click="showText = !showText") Run the Code
				div(ng-if="ballot")
					h1 Ballot: {{ballot.name}}
				// temporarily hide
				.hidden(ng-show="voteBallot || resultsBallot")
					select.form-control(ng-model="ballot" ng-change="voteBallot ? getCandidates() : showResults()" ng-options="item as item.name for item in allBallots track by item.id")
				div(ng-show="createBallot")
					form(name='ballotForm' ng-submit='newBallot()' ng-hide='ballot.id')
						.form-group
							label Name
							input.form-control(name="name" ng-model="ballot.name")
							span.text-danger(ng-show='errors.name') {{errors.name}}
						.form-group
							label Shortcode (for link stvcalculator.com/{{ballot.key}})
							.input-group
								input.form-control(name="key" ng-model="ballot.key" ng-change="checkAvailability()" maxlength=16)
								span.input-group-btn
									button.btn.btn-secondary(type="button" ng-click="generateRandomKey()") New Shortcode
							span.text-danger(ng-show='errors.key') {{errors.key}}
							span.text-success(ng-show='success.key') {{success.key}}
						.form-group
							label Positions to be Elected
							input.form-control(name="positions" ng-model="ballot.positions")
							span.text-danger(ng-show='errors.positions') {{errors.positions}}
						// temporarily hide
						.form-group.hidden
							label Created
							input.form-control(name="created" ng-model="ballot.created")
							span.text-danger(ng-show='errors.created') {{errors.created}}
						.form-group
							label Password Protected
								input(type="checkbox" ng-model="showPassword")
							input.form-control(name="password" ng-model="ballot.password")
							span.text-danger(ng-show='errors.password') {{errors.password}}
						.form-group
							label Voting Cutoff Date
								input(type="checkbox" ng-model="showCutoff")
								small.text-muted(ng-show="showCutoff && ballot.voteCutoff")  {{ballot.voteCutoff | date: dateFormat }}
							div(ng-show="showCutoff")
								.input-group
									input.form-control(type="text" ng-focus="cutoffOpen = true" uib-datepicker-popup="{{pickerFormat}}" datepicker-options="pickerOptions" ng-model="ballot.voteCutoff" is-open="cutoffOpen")
									span.input-group-btn
										button.btn.btn-default(type="button" ng-click="cutoffOpen = !cutoffOpen")
											i.fa.fa-calendar
								uib-timepicker(ng-model="ballot.voteCutoff" minute-step="15")
						.form-group
							label Release Results Date
								input(type="checkbox" ng-model="showRelease")
								small.text-muted(ng-show="showRelease && ballot.resultsRelease")  {{ballot.resultsRelease | date: dateFormat }}
							div(ng-show="showRelease")
								.input-group
									input.form-control(type="text" ng-focus="releaseOpen = true" uib-datepicker-popup="{{pickerFormat}}" datepicker-options="pickerOptions" ng-model="ballot.resultsRelease" is-open="releaseOpen")
									span.input-group-btn
										button.btn.btn-default(type="button" ng-click="releaseOpen = !releaseOpen")
											i.fa.fa-calendar
								uib-timepicker(ng-model="ballot.resultsRelease" minute-step="15")
						input.btn.btn-info(type="submit" value="Submit")
					div(ng-show='ballot.id && !candidates')
						form(name='entriesForm' ng-submit='addEntry()')
							.form-group
								label New Entry (use ENTER to add)
								input.form-control(name="entryInput" ng-model="entryInput")
								span(ng-show='errorEntry && !entryInput') {{errorEntry}}
							button.btn.btn-info(type='submit') Add Entry
							button.btn.btn-default(type='button' ng-click="submitEntries()") Submit
						h2 Current Entry List
							h5(ng-repeat="entry in entries track by $index")
								strong {{$index + 1}}&nbsp;
								| {{entry}}&nbsp;
								i.fa.fa-close.pointer(ng-click="removeEntry($index)")
				div(ng-if='candidates')
					h2 Order by Preference
					h3 {{ballot.positions}} position{{ballot.positions == "1" ? "" : "s"}} available
					form(name='voteForm' ng-submit='submitVote()')
						ul#sortable(ui-sortable ng-model='candidates')
							li(ng-repeat='item in candidates track by $index') {{item}}
								i.fa.fa-close(ng-click="removeCandidate($index)")
						button.btn.btn-primary.clearfix(type='submit') Vote!
						button.btn.btn-default(type="button" ng-click='resetCandidates()') Reset
			div(ng-show="congrats")
				h3 Thank you for creating a ballot!
				h4 Send this url to people for voting: 
				h4.text-success http://stvcalculator.com/{{ballot.key}}
				a.pointer(ng-click="voteNow()") Click here to vote yourself
			div(ng-show="thanks || final")
				h3(ng-hide="final") Thank you for voting!
				button.btn.btn-primary(ng-click="getResults()" ng-hide="final") See Results
				div(ng-show="final")
					h2 The winner{{elected.length == 1 ? "" : "s"}}:
						span(ng-repeat="result in elected")  {{result}}
							span(ng-if="!$last") ,&nbsp;
					button.btn.btn-default.hidden-xs(ng-click="showText = !showText") {{!showText ? "Show" : "Hide"}} details
			table(ng-hide="true")
				tr(ng-repeat="x in names")
					td {{x.Name}}
					td {{x.Country}}
			#bodytext(ng-show="showText")
		script(src='inc/lib.js')
		script(src='inc/main.js')

//		| @@javascriptReplaceFiles

